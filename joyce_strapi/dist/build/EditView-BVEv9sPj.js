import{aY as w,j as e,P as h,a as F,v as B,U as _,aN as q,r as k,b as U,y as K,aJ as O,s as $,bs as D,b0 as G,bt as H,A as Q,e as v,b4 as C,b1 as S,bL as Y,b2 as I,Z as z,T as J,E as m}from"./strapi-DkIoYDWU.js";import{u as Z,a as W,b as X}from"./transferTokens-BUn1uLv8.js";import{T as f}from"./constants-Q2dfXdfa.js";import{F as ee,T as se,a as te,b as ne,L as ae,c as re}from"./TokenTypeSelect-lDs6aHqR.js";import"./index-CWF-zbVy.js";import"./index-BRVyLNfZ.js";const ie=G().shape({name:S().max(100).required(I.required.id),description:S().nullable(),lifespan:Y().integer().min(0).nullable().defined(I.required.id),permissions:S().required(I.required.id)}),oe=()=>{const{formatMessage:r}=F(),{toggleNotification:n}=B(),d=_(),{state:p}=q(),[t,l]=k.useState(p&&"accessKey"in p.transferToken?{...p.transferToken}:null),{trackUsage:o}=U(),x=w(a=>a.admin_app.permissions.settings?.["transfer-tokens"]),{allowedActions:{canCreate:y,canUpdate:L,canRegenerate:R}}=K(x),g=O("/settings/transfer-tokens/:id")?.params?.id,i=g==="create",{_unstableFormatAPIError:T,_unstableFormatValidationErrors:b}=$();k.useEffect(()=>{o(i?"didAddTokenFromList":"didEditTokenFromList",{tokenType:f})},[i,o]);const{data:E,error:j}=Z(g,{skip:i||t!==null||!g});k.useEffect(()=>{j&&n({type:"danger",message:T(j)})},[j,T,n]),k.useEffect(()=>{E&&l(E)},[E]);const[A]=W(),[N]=X(),V=async(a,c)=>{o(i?"willCreateToken":"willEditToken",{tokenType:f});const u=a.permissions.split("-");if((s=>s.length===1?s[0]==="push"||s[0]==="pull":s[0]==="push"&&s[1]==="pull")(u))try{if(i){const s=await A({...a,lifespan:a?.lifespan&&a.lifespan!=="0"?parseInt(a.lifespan.toString(),10):null,permissions:u});if("error"in s){C(s.error)&&s.error.name==="ValidationError"?c.setErrors(b(s.error)):n({type:"danger",message:T(s.error)});return}l(s.data),n({type:"success",message:r({id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"})}),o("didCreateToken",{type:t?.permissions,tokenType:f}),d(`../transfer-tokens/${s.data.id.toString()}`,{replace:!0,state:{transferToken:s.data}})}else{const s=await N({id:g,name:a.name,description:a.description,permissions:u});if("error"in s){C(s.error)&&s.error.name==="ValidationError"?c.setErrors(b(s.error)):n({type:"danger",message:T(s.error)});return}l(s.data),n({type:"success",message:r({id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),o("didEditToken",{type:t?.permissions,tokenType:f})}}catch{n({type:"danger",message:r({id:"notification.error",defaultMessage:"Something went wrong"})})}},M=L&&!i||y&&i;return!i&&!t?e.jsx(h.Loading,{}):e.jsxs(h.Main,{children:[e.jsx(h.Title,{children:r({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Transfer Tokens"})}),e.jsx(D,{validationSchema:ie,validateOnChange:!1,initialValues:{name:t?.name||"",description:t?.description||"",lifespan:t?.lifespan||null,permissions:t?.permissions.join("-")??""},enableReinitialize:!0,onSubmit:(a,c)=>V(a,c),children:({errors:a,handleChange:c,isSubmitting:u,values:P})=>e.jsxs(H,{children:[e.jsx(ee,{title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"TokenCreate Transfer Token"},token:t,setToken:l,canShowToken:!1,canEditInputs:M,canRegenerate:R,isSubmitting:u,regenerateUrl:"/admin/transfer/tokens/"}),e.jsx(Q.Content,{children:e.jsxs(v,{direction:"column",alignItems:"stretch",gap:6,children:[t&&!!t?.name&&"accessKey"in t&&e.jsx(se,{token:t.accessKey,tokenType:f}),e.jsx(le,{errors:a,onChange:c,canEditInputs:M,isCreating:i,values:P,transferToken:t})]})})]})})]})},ke=()=>{const r=w(n=>n.admin_app.permissions.settings?.["transfer-tokens"].read);return e.jsx(h.Protect,{permissions:r,children:e.jsx(oe,{})})},le=({errors:r={},onChange:n,canEditInputs:d,isCreating:p,values:t,transferToken:l={}})=>{const{formatMessage:o}=F(),x=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return e.jsx(z,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsxs(v,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(J,{variant:"delta",tag:"h2",children:o({id:"global.details",defaultMessage:"Details"})}),e.jsxs(m.Root,{gap:5,children:[e.jsx(m.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(te,{error:r.name,value:t.name,canEditInputs:d,onChange:n})},"name"),e.jsx(m.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(ne,{error:r.description,value:t.description,canEditInputs:d,onChange:n})},"description"),e.jsx(m.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(ae,{isCreating:p,error:r.lifespan,value:t.lifespan,onChange:n,token:l})},"lifespan"),e.jsx(m.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(re,{name:"permissions",value:t.permissions,error:r.permissions,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:y=>{n({target:{name:"permissions",value:y}})},options:x,canEditInputs:d})},"permissions")]})]})})};export{oe as EditView,ke as ProtectedEditView};
